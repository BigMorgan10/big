<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå Big M Î™®Í±¥ - Portail Galactique Ultra</title>
    <style>
        /* Styles identiques mais j'ai ajout√© : */
        .access-warning {
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid var(--warning-orange);
            color: var(--warning-orange);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .access-granted {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid var(--success-green);
            color: var(--success-green);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Structure HTML identique jusqu'au JavaScript -->

    <script>
        class GalacticSystem {
            constructor() {
                this.currentUser = null;
                this.staffSession = false;
                this.currentPage = 'home';
                this.securityLogs = [];
                this.activeUsers = [];
                this.fileSystem = new Map();
                this.monitoringActive = false;
                this.analyticsData = { visits: 0, pageViews: 0, sessions: [] };
                
                this.init();
            }

            // MODIFICATION PRINCIPALE : Syst√®me d'acc√®s libre avec avertissements
            showPage(pageId) {
                // Cache toutes les pages
                document.querySelectorAll('.page-section, .dashboard-section').forEach(page => {
                    page.style.display = 'none';
                });

                // V√©rifie les permissions mais laisse passer quand m√™me
                const pagePermissions = {
                    'dashboard': ['user'],
                    'monitoring': ['staff'],
                    'content': ['admin'],
                    'analytics': ['admin'],
                    'security': ['staff']
                };

                const requiredPerms = pagePermissions[pageId] || [];
                const hasPermission = this.checkPermission(requiredPerms);
                
                // Affiche la page s√©lectionn√©e
                const page = document.getElementById(pageId + 'Page');
                if (page) {
                    page.style.display = pageId === 'home' ? 'flex' : 'block';
                    this.currentPage = pageId;
                    
                    // Enregistre la vue de page
                    this.recordPageView(pageId);
                    
                    // Affiche un avertissement si pas les bonnes permissions
                    if (!hasPermission && requiredPerms.length > 0) {
                        this.showAccessWarning(pageId, requiredPerms);
                    } else if (hasPermission) {
                        this.showAccessGranted(pageId);
                    }
                    
                    // Lance les fonctionnalit√©s sp√©cifiques
                    this.startPageFeatures(pageId);
                }
            }

            checkPermission(requiredPerms) {
                if (!this.currentUser && requiredPerms.includes('user')) return false;
                if (!this.currentUser) return false;
                
                // V√©rifie chaque permission requise
                for (let perm of requiredPerms) {
                    if (perm === 'user' && this.currentUser) return true;
                    if (perm === 'staff' && this.staffSession) return true;
                    if (perm === 'admin' && this.currentUser.isAdmin) return true;
                }
                
                return requiredPerms.length === 0; // Si aucune permission requise
            }

            showAccessWarning(pageId, requiredPerms) {
                const page = document.getElementById(pageId + 'Page');
                const warning = document.createElement('div');
                warning.className = 'access-warning';
                warning.innerHTML = `
                    <h3>‚ö†Ô∏è Acc√®s Limit√©</h3>
                    <p>Vous n'avez pas les permissions compl√®tes pour cette page.</p>
                    <p><strong>Permissions requises:</strong> ${requiredPerms.join(', ')}</p>
                    <p><strong>Vos permissions:</strong> ${this.getUserPermissionLevel()}</p>
                    <button class="btn btn-secondary" onclick="this.parentElement.remove()">Compris</button>
                `;
                
                // Ins√®re l'avertissement au d√©but de la page
                page.insertBefore(warning, page.firstChild);
                
                // Active tout de m√™me certaines fonctionnalit√©s de base
                setTimeout(() => {
                    this.enableBasicFeatures(pageId);
                }, 1000);
            }

            showAccessGranted(pageId) {
                const page = document.getElementById(pageId + 'Page');
                const granted = document.createElement('div');
                granted.className = 'access-granted';
                granted.innerHTML = `
                    <h3>‚úÖ Acc√®s Complet</h3>
                    <p>Vous avez acc√®s √† toutes les fonctionnalit√©s de cette page.</p>
                    <button class="btn btn-primary" onclick="this.parentElement.remove()">Super !</button>
                `;
                
                page.insertBefore(granted, page.firstChild);
                
                setTimeout(() => {
                    granted.remove();
                }, 3000);
            }

            getUserPermissionLevel() {
                if (!this.currentUser) return 'Aucune (non connect√©)';
                if (this.currentUser.isAdmin) return 'Administrateur';
                if (this.staffSession) return 'Personnel + Utilisateur';
                return 'Utilisateur';
            }

            enableBasicFeatures(pageId) {
                // Active les fonctionnalit√©s de base m√™me sans permissions compl√®tes
                switch(pageId) {
                    case 'dashboard':
                        this.updateStatistics();
                        break;
                    case 'monitoring':
                        this.startRealTimeMonitoring();
                        break;
                    case 'content':
                        this.updateFileList();
                        break;
                    case 'analytics':
                        this.updateAnalyticsDisplay();
                        break;
                    case 'security':
                        this.updateSecurityLogs();
                        break;
                }
            }

            startPageFeatures(pageId) {
                // Lance les fonctionnalit√©s avanc√©es si permissions suffisantes
                if (this.checkPermission(['user'])) {
                    switch(pageId) {
                        case 'dashboard':
                            this.updateStatistics();
                            break;
                        case 'monitoring':
                            if (this.checkPermission(['staff'])) {
                                this.startRealTimeMonitoring();
                            } else {
                                this.enableBasicFeatures(pageId);
                            }
                            break;
                        case 'content':
                            if (this.checkPermission(['admin'])) {
                                this.initializeFileSystem();
                            } else {
                                this.enableBasicFeatures(pageId);
                            }
                            break;
                        case 'analytics':
                            if (this.checkPermission(['admin'])) {
                                this.updateAnalyticsDisplay();
                            } else {
                                this.enableBasicFeatures(pageId);
                            }
                            break;
                        case 'security':
                            if (this.checkPermission(['staff'])) {
                                this.updateSecurityLogs();
                            } else {
                                this.enableBasicFeatures(pageId);
                            }
                            break;
                    }
                } else {
                    // Utilisateur non connect√© - acc√®s tr√®s limit√©
                    this.showNotification('Connectez-vous pour plus de fonctionnalit√©s', 'warning');
                }
            }

            // MODIFICATION : Navigation toujours visible mais avec indicateurs
            updateNavigation() {
                if (!this.currentUser) {
                    // Si pas connect√©, montre tout mais avec des ic√¥nes de verrou
                    document.querySelectorAll('.nav-link').forEach(link => {
                        if (link.id && link.id.startsWith('nav')) {
                            link.style.display = 'block';
                            if (!link.textContent.includes('üîí')) {
                                link.innerHTML = 'üîí ' + link.textContent;
                            }
                        }
                    });
                    return;
                }

                // Connect√© - montre tout avec indicateurs de permission
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.id && link.id.startsWith('nav')) {
                        const pageId = link.id.replace('nav', '').toLowerCase();
                        const hasAccess = this.checkPagePermission(pageId);
                        
                        link.style.display = 'block';
                        
                        // Ajoute des ic√¥nes de permission
                        if (hasAccess) {
                            link.innerHTML = '‚úÖ ' + link.textContent.replace(/[üîí‚úÖ‚ö†Ô∏è]/g, '');
                        } else {
                            link.innerHTML = '‚ö†Ô∏è ' + link.textContent.replace(/[üîí‚úÖ‚ö†Ô∏è]/g, '');
                        }
                    }
                });
            }

            checkPagePermission(pageId) {
                const pagePermissions = {
                    'dashboard': ['user'],
                    'monitoring': ['staff'],
                    'content': ['admin'],
                    'analytics': ['admin'],
                    'security': ['staff']
                };
                
                const required = pagePermissions[pageId] || [];
                return this.checkPermission(required);
            }

            // Le reste du code reste identique mais avec cette nouvelle logique d'acc√®s
            // Les m√©thodes like staffLogin(), updateStatistics(), etc. restent les m√™mes
            
            // ... (ins√®re ici tout le reste du code JavaScript pr√©c√©dent)
            
            // Une petite modification pour que les boutons de navigation fonctionnent toujours
            showPage(pageId) {
                // ... (code existant)
                
                // MAIS on laisse toujours passer vers la page
                if (page) {
                    page.style.display = pageId === 'home' ? 'flex' : 'block';
                    this.currentPage = pageId;
                    this.recordPageView(pageId);
                    
                    if (!hasPermission && requiredPerms.length > 0) {
                        this.showAccessWarning(pageId, requiredPerms);
                    } else if (hasPermission) {
                        this.showAccessGranted(pageId);
                    }
                    
                    this.startPageFeatures(pageId);
                }
            }
        }

        // ====================================================================
        // üöÄ INITIALISATION ET FONCTIONS GLOBALES
        // ====================================================================

        let galacticSystem;

        // Global functions
        function enterPortal() {
            if (!galacticSystem) galacticSystem = new GalacticSystem();
            galacticSystem.enterPortal();
        }

        function staffLogin() {
            galacticSystem.staffLogin();
        }

        function toggleStaffAccess() {
            galacticSystem.toggleStaffAccess();
        }

        function generateQR() {
            galacticSystem.generateQR();
        }

        function showPage(pageId) {
            galacticSystem.showPage(pageId);
        }

        function logout() {
            galacticSystem.logout();
        }

        // ... (toutes les autres fonctions restent identiques)

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            galacticSystem = new GalacticSystem();
            
            // Montre toujours la navigation mais avec des indicateurs
            document.getElementById('mainHeader').style.display = 'block';
            galacticSystem.updateNavigation();
        });
    </script>
</body>
</html>
